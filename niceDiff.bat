@echo OFF
SETLOCAL ENABLEEXTENSIONS
:: name of running script
SET me=%~n0 
:: path to script folder
SET parent=%~dp0

SET branchA=%1
SET branchB=%2
SET comparePath=%3

:: validate 1st parametr
IF "%branchA%"=="" (
  echo %me%: incorrect parameters. Please use: niceDiff ^<branch1-name^> ^<branch2-name^> [optional ^<path-to-comparing-files^>]
  GOTO:EOF
)

:: validate 2nd parametr
IF "%branchB%"=="" (
  echo %me%: incorrect parameters. Please use: niceDiff ^<branch1-name^> ^<branch2-name^> [optional ^<path-to-comparing-files^>]
  GOTO:EOF
)

:: get difference and write into file
ECHO preparing raw difference...
git diff --minimal %branchA% %branchB% %3 > %parent%/diff.txt
:: note: --minimal flag get line different, --word-diff is nuclear diff

:: parce file into html

:: add top part of template
TYPE %parent%template_top_report.html> niceDiff-report.html
:: add branches to the header
SET svgBranch="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZpZXdCb3g9IjAgMCAxNzIgMTcyIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9Im5vbnplcm8iIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLWxpbmVqb2luPSJtaXRlciIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2UtZGFzaGFycmF5PSIiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiBmb250LWZhbWlseT0ibm9uZSIgZm9udC13ZWlnaHQ9Im5vbmUiIGZvbnQtc2l6ZT0ibm9uZSIgdGV4dC1hbmNob3I9Im5vbmUiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTogbm9ybWFsIj48cGF0aCBkPSJNMCwxNzJ2LTE3MmgxNzJ2MTcyeiIgZmlsbD0ibm9uZSI+PC9wYXRoPjxnIGZpbGw9IiM1MGUwZDkiPjxwYXRoIGQ9Ik00NC43OTE2NywxNy45MTY2N2MtMTIuODQyNjcsMCAtMjMuMjkxNjcsMTAuNDQ5IC0yMy4yOTE2NywyMy4yOTE2N2MwLDEwLjk5MDg2IDcuNjU5ODksMjAuMjA1MyAxNy45MTY2NywyMi42NDA3OXY1Mi42MDkyMWMwLDEwLjgyMDg2IDguODg3NDgsMTkuNzA4MzMgMTkuNzA4MzMsMTkuNzA4MzNoMTUuNjkxMDhsLTUuMTU4MDQsNS4xNTgwNGMtMS40MDQxMiwxLjM0ODE1IC0xLjk2OTcxLDMuMzUwMDUgLTEuNDc4NjYsNS4yMzM2NGMwLjQ5MTA1LDEuODgzNTkgMS45NjIwMiwzLjM1NDU2IDMuODQ1NjEsMy44NDU2MWMxLjg4MzU5LDAuNDkxMDUgMy44ODU0OSwtMC4wNzQ1NSA1LjIzMzY0LC0xLjQ3ODY2bDE0LjMzMzMzLC0xNC4zMzMzM2MyLjA5ODIzLC0yLjA5OTEgMi4wOTgyMywtNS41MDE0OSAwLC03LjYwMDU5bC0xNC4zMzMzMywtMTQuMzMzMzNjLTEuMDEyMjIsLTEuMDQyNCAtMi40MDMzLC0xLjYzMDY0IC0zLjg1NjI4LC0xLjYzMDdjLTIuMTg4MTQsMC4wMDA1MyAtNC4xNTc2LDEuMzI3MzUgLTQuOTgwMDYsMy4zNTUwNGMtMC44MjI0NSwyLjAyNzcgLTAuMzMzNzUsNC4zNTE1NiAxLjIzNTc1LDUuODc2MjRsNS4xNTgwNCw1LjE1ODA0aC0xNS42OTEwOGMtNS4wMTAzMSwwIC04Ljk1ODMzLC0zLjk0ODAyIC04Ljk1ODMzLC04Ljk1ODMzdi01Mi42MDkyMWMxMC4yNTY3NywtMi40MzU0OSAxNy45MTY2NywtMTEuNjQ5OTMgMTcuOTE2NjcsLTIyLjY0MDc5YzAsLTEyLjg0MjY3IC0xMC40NDksLTIzLjI5MTY3IC0yMy4yOTE2NywtMjMuMjkxNjd6TTk4LjQzNjY5LDIxLjQ1MTAxYy0xLjM5NTkyLDAuMDQwNjggLTIuNzIxMjEsMC42MjMwMSAtMy42OTUzMSwxLjYyMzdsLTE0LjMzMzMzLDE0LjMzMzMzYy0yLjA5ODIzLDIuMDk5MSAtMi4wOTgyMyw1LjUwMTQ5IDAsNy42MDA1OWwxNC4zMzMzMywxNC4zMzMzM2MxLjM0ODE1LDEuNDA0MTIgMy4zNTAwNSwxLjk2OTcxIDUuMjMzNjQsMS40Nzg2NmMxLjg4MzU5LC0wLjQ5MTA1IDMuMzU0NTYsLTEuOTYyMDIgMy44NDU2MSwtMy44NDU2MWMwLjQ5MTA1LC0xLjg4MzU5IC0wLjA3NDU1LC0zLjg4NTQ5IC0xLjQ3ODY2LC01LjIzMzY0bC01LjE1ODA0LC01LjE1ODA0aDE1LjY5MTA4YzUuMDEwMzEsMCA4Ljk1ODMzLDMuOTQ4MDIgOC45NTgzMyw4Ljk1ODMzdjUyLjYwOTIxYy0xMC4yNTY3NywyLjQzNTQ5IC0xNy45MTY2NywxMS42NDk5MyAtMTcuOTE2NjcsMjIuNjQwNzljMCwxMi44NDI2NyAxMC40NDksMjMuMjkxNjcgMjMuMjkxNjcsMjMuMjkxNjdjMTIuODQyNjcsMCAyMy4yOTE2NywtMTAuNDQ5IDIzLjI5MTY3LC0yMy4yOTE2N2MwLC0xMC45OTA4NiAtNy42NTk4OSwtMjAuMjA1MyAtMTcuOTE2NjcsLTIyLjY0MDc5di01Mi42MDkyMWMwLC0xMC44MjA4NiAtOC44ODc0OCwtMTkuNzA4MzMgLTE5LjcwODMzLC0xOS43MDgzM2gtMTUuNjkxMDhsNS4xNTgwNCwtNS4xNTgwNGMxLjU4NzA2LC0xLjU0NTY2IDIuMDYzMzYsLTMuOTA2NjYgMS4xOTk2NiwtNS45NDY3MmMtMC44NjM3LC0yLjA0MDA3IC0yLjg5MDQ4LC0zLjM0MTM0IC01LjEwNDkzLC0zLjI3NzU2eiI+PC9wYXRoPjwvZz48L2c+PC9zdmc+"
ECHO ^<p id="branches"^> ^<img src=%svgBranch% width="18" height="18"^> %branchA% ^< %branchB% ^</p^>>> niceDiff-report.html

call parseDiff.bat 

